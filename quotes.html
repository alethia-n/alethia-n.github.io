<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alethia ‚Äî Citations</title>

  <!-- üîó Feuille de style principale -->
  <link rel="stylesheet" href="style.css" />

  <!-- üîó Importation Firebase -->
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js"></script>
</head>

<body>
  <!-- ‚úÖ En-t√™te g√©n√©ral -->
  <header id="main-header">
    <h1>Alethia ‚Äî Citations</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="courses/">Courses</a>
      <a href="quotes.html" class="active">Quotes</a>
      <a href="contact.html">Contact</a>
      <button id="logout-btn">Se d√©connecter</button>
    </nav>
  </header>

  <!-- ‚úÖ Contenu principal -->
  <main id="quotes-container">
    <h2>‚ú® Citations inspirantes</h2>
    <div id="quotes-list">
      <p>Chargement des citations...</p>
    </div>
  </main>

  <!-- ‚úÖ Message si non connect√© -->
  <div id="login-required" style="display:none;">
    <h3>‚ö†Ô∏è Acc√®s restreint</h3>
    <p>Veuillez vous <a href="login.html">connecter</a> ou cr√©er un compte pour acc√©der aux citations et au chat.</p>
  </div>

  <!-- ‚úÖ Script principal -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { firebaseConfig } from "./firebase-config.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const quotesContainer = document.getElementById("quotes-container");
    const loginNotice = document.getElementById("login-required");
    const logoutBtn = document.getElementById("logout-btn");

    // üîí V√©rifie si l‚Äôutilisateur est connect√©
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        quotesContainer.style.display = "block";
        loginNotice.style.display = "none";
        logoutBtn.style.display = "inline-block";

        // üîπ Charge les citations
        const querySnapshot = await getDocs(collection(db, "quotes"));
        const quotesList = document.getElementById("quotes-list");
        quotesList.innerHTML = "";

        querySnapshot.forEach((doc) => {
          const quote = doc.data();
          const quoteDiv = document.createElement("div");
          quoteDiv.className = "quote-item";
          quoteDiv.innerHTML = `
            <blockquote>"${quote.text}"</blockquote>
            <cite>‚Äî ${quote.author || "Anonyme"}</cite>
          `;
          quotesList.appendChild(quoteDiv);
        });
      } else {
        quotesContainer.style.display = "none";
        loginNotice.style.display = "block";
        logoutBtn.style.display = "none";
      }
    });

    // üî∏ D√©connexion
    logoutBtn.addEventListener("click", () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });
  </script>

  <!-- ‚úÖ Chat int√©gr√© (affich√© seulement si connect√©) -->
  <script type="module" src="chat.js"></script>
</body>
</html>
